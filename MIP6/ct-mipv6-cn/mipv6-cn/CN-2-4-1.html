<HTML>
<HEAD>
<TITLE>CN-2-4-1 - Receiving mobility message - Invalid MH Type</TITLE>
<LINK REV="made" HREF="mailto:hackers@FreeBSD.org">
</HEAD>

<BODY>

<!-- INDEX BEGIN -->
<!--

<UL>

	<LI><A HREF="#NAME">NAME</A>
	<LI><A HREF="#TARGET">TARGET</A>
	<LI><A HREF="#TOPOLOGY">TOPOLOGY</A>
	<LI><A HREF="#INITIALIZATION">INITIALIZATION</A>
	<LI><A HREF="#TEST_PROCEDURE">TEST PROCEDURE</A>
	<LI><A HREF="#JUDGEMENT">JUDGEMENT</A>
	<LI><A HREF="#REFERENCE">REFERENCE</A>
</UL>
-->
<!-- INDEX END -->

<P>
<H1><A NAME="NAME">NAME</A></H1>
<P>
CN-2-4-1 - Receiving mobility message - Invalid MH Type

<P>
<HR>
<H1><A NAME="TARGET">TARGET</A></H1>
<PRE>
Host/Router
</PRE>

<P>
<HR>
<H1><A NAME="TOPOLOGY">TOPOLOGY</A></H1>
<PRE>
                           HA                     
                           |                       
                 ----------+----+----------------- Home 
                                |                  
                                R2                 
                                |                  
                 ----------+----+----------------- Link2 (Foreign)
                           |                       
                           R1           MN         
                           |            |          
                 ----------+----+-------+--------- Link1 (Foreign)
                                |                  
                                R0          NUT    
                                |            |     
       -------------------------+------------+---- Link0
</PRE>
<blockquote>
<table border>
<tbody>
<blockquote><table border><tbody>
<TR><TD><TT>Link0</TT></TD>
<TD><TT>3ffe:501:ffff:100::/64</TT></TD>
<TD><TT>&nbsp;</TT></TD></TR>
<TR><TD><TT>Link1</TT></TD>
<TD><TT>3ffe:501:ffff:101::/64</TT></TD>
<TD><TT>Foreign Link</TT></TD></TR>
<TR><TD><TT>Link2</TT></TD>
<TD><TT>3ffe:501:ffff:102::/64</TT></TD>
<TD><TT>Foreign Link 2</TT></TD></TR>
<TR><TD><TT>Home Link</TT></TD>
<TD><TT>3ffe:501:ffff:104::/64</TT></TD>
<TD><TT>Home Link</TT></TD></TR>
<TR><TD><TT>CN(NUT)</TT></TD>
<TD><TT>3ffe:501:ffff:100::X<BR>Auto Configuration (InterfaceID)</TT></TD>
<TD><TT>&nbsp;</TT></TD></TR>
<TR><TD><TT>MN(in Link1)</TT></TD>
<TD><TT>3ffe:501:ffff:101::Y<BR>Increased in each test</TT></TD>
<TD><TT>MN care-of address</TT></TD></TR>
<TR><TD><TT>MN(in Home Link)</TT></TD>
<TD><TT>3ffe:501:ffff:104::Y<BR>Increased in each test</TT></TD>
<TD><TT>MN home address</TT></TD></TR>
<TR><TD><TT>R0(Link0)</TT></TD>
<TD><TT>3ffe:501:ffff:100::1</TT></TD>
<TD><TT>&nbsp;</TT></TD></TR>
<TR><TD><TT>R1(Link1)</TT></TD>
<TD><TT>3ffe:501:ffff:101::1</TT></TD>
<TD><TT>&nbsp;</TT></TD></TR>
<TR><TD><TT>R2(Link2)</TT></TD>
<TD><TT>3ffe:501:ffff:102::1</TT></TD>
<TD><TT>&nbsp;</TT></TD></TR>
<TR><TD><TT>HA(Home Link)</TT></TD>
<TD><TT>3ffe:501:ffff:104::1</TT></TD>
<TD><TT>&nbsp;</TT></TD></TR>
</tbody></table></blockquote>
</tbody></table>
</blockquote>

<P>
<HR>
<H1><A NAME="INITIALIZATION">INITIALIZATION</A></H1>
<PRE>
</PRE>
<PRE>
Reboot NUT
</PRE>
<PRE>
       MN      R1      HA      R0     CN(NUT) 
        |       |       |       |       |
        |       |       |       |------>| 1.RA
        |       |       |       |       |
        |       |       |       |------>| 2.NS
        |       |       |       |       |
        |       |       |       |<------| 3.NA
        |       |       |       |       |
        |-------------->|-------------->| 4.Echo Request
        |       |       |       |       |
        |<--------------|<--------------| 5.Echo Reply
        |       |       |       |       |
        |------------------------------>| 6.Echo Request(Home Address option)
        |       |       |       |       |
        |<------------------------------| 7.BE(Status=1)
        |       |       |       |       |
</PRE>
<PRE>
1. Send Router Advertisement.
2. Send Neighbor Solicitation.
3. Receive Neighbor Advertisement.
4. Send ICMP Echo Request.
5. Receive ICMP Echo Reply.
6. Send ICMP Echo Request(Home Address option).
7. Receive Binding Error(Status=1).
</PRE>
<PRE>
</PRE>

<P>
<HR>
<H1><A NAME="TEST_PROCEDURE">TEST PROCEDURE</A></H1>
<PRE>
       MN      R1      HA      R0     CN(NUT) 
        |       |       |       |       |
        |-------------->|-------------->| 1.Invalid Message(MH Type=8, HoTI format)
        |       |       |       |       |
        |<--------------|<--------------| 2.Binding Error(Status=2) (*1)
        |       |       |       |       |
        |-------------->|-------------->| 3.Invalid Message(MH Type=8, HoTI format, Source Address=Multicust address)
        |       |       |       |       |
        |       |       |       |       | (*2)
        |       |       |       |       |
        |------------------------------>| 4.Invalid Message(MH Type=8, BU format with Home Address option)
        |       |       |       |       |
        |<------------------------------| 5.Binding Error(Status=2) (*3)
        |       |       |       |       |
</PRE>
<PRE>
1. Send Home Test Init(MH Type=8, HoTI format).
2. Receive Binding Error(Status=2).
3. Send Home Test Init(MH Type=8, HoTI format, Source Address=Multicust address)
   *Expire HoT timer.
4. Send Binding Update(MH Type=8, BU format with Home Address option).
5. Receive Binding Error(Status=2).
</PRE>
<PRE>
Packet Format
1. <a href="../images/Home_Test_Init_message_format_receiving_ESP.gif">Home Test Init</a>
2. <a href="../images/Binding_Error_message_format_from_CN_to_MN.gif">Binding Error</a>
3. <a href="../images/Home_Test_Init_message_format_receiving_ESP.gif">Home Test Init</a>
4. <a href="../images/Binding_Update_message_format_from_MN_to_CN.gif">Binding Update</a>
5. <a href="../images/Binding_Error_message_format_from_CN_to_MN.gif">Binding Error</a>
</PRE>
<PRE>
</PRE>

<P>
<HR>
<H1><A NAME="JUDGEMENT">JUDGEMENT</A></H1>
<PRE>
</PRE>
<PRE>
(*1) MN receives Binding Error.
  - The Destination Address is set to pseudo Home Test Init (MN home address).
  - The Status field is set to 2.
</PRE>
<PRE>
(*2) MN does not receive Binding Error.
</PRE>
<PRE>
(*3) MN receives Binding Error.
  - The Destination Address is set to pseudo Binding Update (MN care-of address).
  - The Status field is set to 2.
  - The Home Address field is set to the value in the Home Address option in the pseudo Binding Update (MN home address).
</PRE>
<PRE>
</PRE>

<P>
<HR>
<H1><A NAME="REFERENCE">REFERENCE</A></H1>
<PRE>
RFC3775 Mobility Support in IPv6
    See Section 9.2, 9.3.3
</PRE>
</BODY>

</HTML>
